<!doctype html>
<html>
  <head>
    <script src="../../imd/imd.js"></script>
    <script src="../lib/scheduler.js"></script>
    <style>
      #container > span {
        display: inline-block;
        padding: 16px;
        border: solid 1px gray;
      }
    </style>
  </head>
  <body>
    <button id="stop">Stop<button>
    <div id="container"></div>
    <script>
      define(['../lib/scheduler.js'], (schedulerLib) => {
        const Scheduler = schedulerLib.Scheduler;
        const AnimationFrameQueueScheduler = schedulerLib.AnimationFrameQueueScheduler;

        const scheduler = new Scheduler();
        const stopButton = document.querySelector('#stop');
        const container = document.querySelector('#container');

        let stopped = false;
        stopButton.addEventListener('click', () => {
          stopped = true;
        });

        scheduler.addQueue('animation', new AnimationFrameQueueScheduler());

        let i = 0;

        const task = async (context) => {
          while (!stopped) {
            const span = document.createElement('span');
            span.innerText = `span #${i++}`;
            container.appendChild(span);
            await context.nextTick();
          }
        }
        (async () => {
          const result = await scheduler.scheduleTask('animation', task);
          console.log(result);
        })();
      });
    </script>
  </body>
</html>
